# 基于Spring Cloud和PyWPS + PyQGIS的分布式在线地理信息服务

本项目通过使用Spring Cloud配合pyWPS搭建集群，实现发布一个分布式的在线地理信息处理的在线云服务（分布式WPS服务）。

## 1，架构概述

整体架构图如下：

![image-20240605144808693](https://swsk33-note.oss-cn-shanghai.aliyuncs.com/image-20240605144808693.png)

上述组成部分：

- `Consul`是服务注册中心，它能够使多个服务模块集群注册到该注册中心，并提供服务发现功能
- `Gateway`是网关，位于最外层接收全部用户的请求，在接收到请求后，它能够从注册中心获取已注册服务的集群信息，包括一个集群中所有节点，然后再通过线性轮询的方式实现负载均衡，将用户请求平摊转发至一个集群的不同节点上
- 服务调用模块和`pyWPS`服务共同构成服务调用模块集群中的一个节点，其中每个服务调用模块使用Spring Boot开发，它们启动时会将自己注册到注册中心，并接收网关转发来的请求，接收到请求之后它们会将请求转发给`pyWPS`服务，来调用实际的`pyQGIS`的算子，并最终返回结果

## 2，Spring Cloud相关简介

Spring Cloud提供了一个完整的分布式微服务解决方案和实现，除了第一代实现Spring Cloud Netflix之外，还有成熟的第二代实现Spring Cloud Alibaba，当然Spring Cloud本身也在后续提供了一些组件的实现。

本项目所使用的相关组件如下。

### (1) Consul注册中心

在分布式微服务中，所有的模块不再全部写在一个项目中，一个大型应用可能被拆分成多个模块并部署至不同的服务器节点上，这就需要面临下列问题：

- 远程调用：模块之间存在依赖时，需要远程调用
- 集群部署：同一个功能模块可以部署成集群，即有多个节点构成

如果没有注册中心，那么服务之间只能直接进行调用：

![](https://swsk33-note.oss-cn-shanghai.aliyuncs.com/image-20220312225248419.png)

这样如果服务地址发生变化，或者临时增加、减少节点，那么就需要修改每个服务代码或者配置。

因此引入注册中心，让每个服务都把自己注册进去，调用时要从注册中心去找服务：

![](https://swsk33-note.oss-cn-shanghai.aliyuncs.com/image-20220312225536773.png)

Consul是一个由Go语言开发的、高性能的分布式网络服务，常常作为我们的服务注册和发现中心使用，作为注册中心使用简单，性能好，并且支持多种语言开发的微服务进行注册，占用资源也很小。

### (2) Spring Cloud Gateway

当我们部署了多个服务集群之后，用户需要知道每一个服务的地址才能够进行调用，因此**网关**在微服务中也是非常重要的。

使用Spring Cloud Gateway，用户（前端）的请求只需全部交给Gateway即可，Gateway会根据我们设定的条件判断这个请求转发到哪个微服务上，除此之外Gateway还可以去服务注册中心去寻找服务并转发给目标服务。

![](https://swsk33-note.oss-cn-shanghai.aliyuncs.com/image-20220411213209809.png)